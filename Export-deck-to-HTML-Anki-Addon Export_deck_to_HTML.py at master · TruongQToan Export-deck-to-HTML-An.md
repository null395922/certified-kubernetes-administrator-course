# Export-deck-to-HTML-Anki-Addon/Export_deck_to_HTML.py at master · TruongQToan/Export-deck-to-HTML-Anki-Addon · GitHub
[Export-deck-to-HTML-Anki-Addon/Export_deck_to_HTML.py at master · TruongQToan/Export-deck-to-HTML-Anki-Addon · GitHub](https://hub.gitfast.tk/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py) 

              Export-deck-to-HTML-Anki-Addon/Export\_deck\_to\_HTML.py at master · TruongQToan/Export-deck-to-HTML-Anki-Addon · GitHub                                         

[Skip to content](#start-of-content)

[](https://github.com/)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo)

-   Product

    -   [Features](/features)
    -   [Mobile](/mobile)
    -   [Actions](/features/actions)
    -   [Codespaces](/features/codespaces)
    -   [Copilot](/features/copilot)
    -   [Packages](/features/packages)
    -   [Security](/features/security)
    -   [Code review](/features/code-review)
    -   [Issues](/features/issues)
    -   [Discussions](/features/discussions)
    -   [Integrations](/features/integrations)
    -   [GitHub Sponsors](/sponsors)
    -   [Customer stories](/customer-stories)
-   [Team](/team)
-   [Enterprise](/enterprise)
-   Explore

    -   [Explore GitHub](/explore)
    -   Learn and contribute
    -   [Topics](/topics)
    -   [Collections](/collections)
    -   [Trending](/trending)
    -   [Skills](https://skills.github.com/)
    -   [GitHub Sponsors](/sponsors/explore)
    -   [Open source guides](https://opensource.guide)
    -   Connect with others
    -   [The ReadME Project](/readme)
    -   [Events](/events)
    -   [Community forum](https://github.community)
    -   [GitHub Education](https://education.github.com)
    -   [GitHub Stars program](https://stars.github.com)
-   [Marketplace](/marketplace)
-   Pricing

    -   [Plans](/pricing)
    -   [Compare plans](/pricing#compare-features)
    -   [Contact Sales](https://github.com/enterprise/contact)
    -   [Education](https://education.github.com)


-   In this repository All GitHub ↵

    Jump to ↵


-   No suggested jump to results

-   In this repository All GitHub ↵

    Jump to ↵

-   In this user All GitHub ↵

    Jump to ↵

-   In this repository All GitHub ↵

    Jump to ↵

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTruongQToan%2FExport-deck-to-HTML-Anki-Addon%2Fblob%2Fmaster%2FExport_deck_to_HTML.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=TruongQToan%2FExport-deck-to-HTML-Anki-Addon)

[TruongQToan](/TruongQToan) / **[Export-deck-to-HTML-Anki-Addon](/TruongQToan/Export-deck-to-HTML-Anki-Addon)** Public

-   [Notifications](/login?return_to=%2FTruongQToan%2FExport-deck-to-HTML-Anki-Addon)
-   [Fork 3](/login?return_to=%2FTruongQToan%2FExport-deck-to-HTML-Anki-Addon)
-   [Star 0](/login?return_to=%2FTruongQToan%2FExport-deck-to-HTML-Anki-Addon)


-   [Code](/TruongQToan/Export-deck-to-HTML-Anki-Addon)
-   [Issues 2](/TruongQToan/Export-deck-to-HTML-Anki-Addon/issues)
-   [Pull requests 1](/TruongQToan/Export-deck-to-HTML-Anki-Addon/pulls)
-   [Actions](/TruongQToan/Export-deck-to-HTML-Anki-Addon/actions)
-   [Projects 0](/TruongQToan/Export-deck-to-HTML-Anki-Addon/projects?type=new)
-   [Wiki](/TruongQToan/Export-deck-to-HTML-Anki-Addon/wiki)
-   [Security](/TruongQToan/Export-deck-to-HTML-Anki-Addon/security)
-   [Insights](/TruongQToan/Export-deck-to-HTML-Anki-Addon/pulse)

More

-   [Code](/TruongQToan/Export-deck-to-HTML-Anki-Addon)
-   [Issues](/TruongQToan/Export-deck-to-HTML-Anki-Addon/issues)
-   [Pull requests](/TruongQToan/Export-deck-to-HTML-Anki-Addon/pulls)
-   [Actions](/TruongQToan/Export-deck-to-HTML-Anki-Addon/actions)
-   [Projects](/TruongQToan/Export-deck-to-HTML-Anki-Addon/projects?type=new)
-   [Wiki](/TruongQToan/Export-deck-to-HTML-Anki-Addon/wiki)
-   [Security](/TruongQToan/Export-deck-to-HTML-Anki-Addon/security)
-   [Insights](/TruongQToan/Export-deck-to-HTML-Anki-Addon/pulse)

[Permalink](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/7800d0c5a2cf425d948aa981288cf97e0190a906/Export_deck_to_HTML.py)

master

Switch branches/tags

Branches Tags

[View all branches](/TruongQToan/Export-deck-to-HTML-Anki-Addon/branches)

[View all tags](/TruongQToan/Export-deck-to-HTML-Anki-Addon/tags)

[Export-deck-to-HTML-Anki-Addon](/TruongQToan/Export-deck-to-HTML-Anki-Addon)/**Export_deck_to_HTML.py** / Jump to

Code definitions

[AddonDialog Class](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L27) [\_\_init\_\_ Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L30) [\_handle_button Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L46) [\_setup_ui Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L53) [\_select_deck Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L110) [\_setup_css Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L115) [\_setup_html Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L123) [\_on_save Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L137) [\_convert_to_multiple_choices Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L145) [\_select_fields Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L154) [\_on_accept Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L169) [\_on_reject Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L229) [SaveFileDialog Class](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L233) [\_\_init\_\_ Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L235) [\_init_ui Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L246) [\_get_file Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L251) [display_dialog Function](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blob/master/Export_deck_to_HTML.py#L267)

## Code navigation index up-to-date

[Go to file](/TruongQToan/Export-deck-to-HTML-Anki-Addon/find/master)

-   [Go to file T](/TruongQToan/Export-deck-to-HTML-Anki-Addon/find/master)

-   Go to line L

-   Go to definition R

-   Copy path

-   Copy permalink

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Cannot retrieve contributors at this time

275 lines (232 sloc) 9.81 KB

[Raw](/TruongQToan/Export-deck-to-HTML-Anki-Addon/raw/master/Export_deck_to_HTML.py) [Blame](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blame/master/Export_deck_to_HTML.py)

 Edit this file

E

[Open in GitHub Desktop](https://desktop.github.com)

-   [Open with Desktop](https://desktop.github.com)
-   [View raw](/TruongQToan/Export-deck-to-HTML-Anki-Addon/raw/master/Export_deck_to_HTML.py)
-   Copy raw contents Copy raw contents Copy raw contents Copy raw contents
-   [View blame](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blame/master/Export_deck_to_HTML.py)

|  | from aqt import mw, utils, browser |
|  | from aqt.qt import \* \|
|  | from os.path import expanduser, join |
|  | from pickle import load, dump |

|  | import os |
|  | import re |
|  | import sys |

|  | html_template \\= """ |
\|  \| <!DOCTYPE html> \|
\|  \| <html> \|
\|  \| <head> \|
\|  \| <meta charset="UTF-8"> \|
\|  \| <style> \|
|  | {{style}} |
\|  \| </style> \|
\|  \| </head> \|
\|  \| <body> \|
|  | {{body}} |
\|  \| </body> \|
\|  \| </html> \|
|  | """ |

|  | delimiter \\= "####" |

|  | class AddonDialog(QDialog): |

|  | """Main Options dialog""" |
|  | def \_\_init\_\_(self): |
|  | QDialog.\_\_init\_\_(self, parent\\=mw) |
|  | self.path \\= None |
|  | self.deck \\= None |
|  | self.fields \\= {} |
|  | self.config_file \\= "export_decks_to_html_config.config" |
|  | if os.path.exists(self.config_file): |
|  | try: |
|  | self.config \\= load(open(self.config_file, 'rb')) |
|  | except: |
|  | self.config \\= {} |
|  | else: |
|  | self.config \\= {} |
|  | self.\_setup_ui() |

|  | def \_handle_button(self): |
|  | dialog \\= OpenFileDialog() |
|  | self.path \\= dialog.filename |
|  | if self.path is not None: |
|  | utils.showInfo("Choose file successful.") |

|  | def \_setup_ui(self): |
|  | """Set up widgets and layouts""" |
|  | layout \\= QGridLayout() |
|  | layout.setSpacing(10) |

|  | deck_label \\= QLabel("Choose deck") |
|  | self.labels \\= \[] \|

|  | self.deck_selection \\= QComboBox() |
|  | deck_names \\= sorted(mw.col.decks.allNames()) |
|  | current_deck \\= mw.col.decks.current()\['name'] \|
|  | deck_names.insert(0, current_deck) |
|  | for i in range(len(deck_names)): |
|  | if deck_names\[i] \\== 'Default': |
|  | deck_names.pop(i) |
|  | break |
|  | self.deck_selection.addItems(deck_names) |
|  | self.deck_selection.currentIndexChanged.connect(self.\_select_deck) |
|  | layout.addWidget(deck_label, 1, 0, 1, 1) |
|  | layout.addWidget(self.deck_selection, 1, 1, 1, 2) |

|  | css_label \\= QLabel('CSS') |
|  | self.css_tb \\= QTextEdit(self) |
|  | self.css_tb.resize(380,60) |
|  | self.css_tb.setPlainText(self.\_setup_css()) |
|  | layout.addWidget(css_label, 2, 0, 1, 1) |
|  | layout.addWidget(self.css_tb, 2, 1, 1, 2) |

|  | html_label \\= QLabel('HTML') |
|  | self.html_tb \\= QTextEdit(self) |
|  | self.html_tb.resize(380,60) |
|  | self.html_tb.setPlainText(self.\_setup_html()) |
|  | layout.addWidget(html_label, 3, 0, 1, 1) |
|  | layout.addWidget(self.html_tb, 3, 1, 1, 2) |

\|  \| # Main button box |
|  | ok_btn \\= QPushButton("Export") |
|  | save_btn \\= QPushButton("Save") |
|  | cancel_btn \\= QPushButton("Cancel") |

|  | button_box \\= QHBoxLayout() |
|  | ok_btn.clicked.connect(self.\_on_accept) |
|  | save_btn.clicked.connect(self.\_on_save) |
|  | cancel_btn.clicked.connect(self.\_on_reject) |
|  | button_box.addWidget(ok_btn) |
|  | button_box.addWidget(save_btn) |
|  | button_box.addWidget(cancel_btn) |

\|  \| # Main layout |
|  | main_layout \\= QVBoxLayout() |
|  | main_layout.addLayout(layout) |
|  | main_layout.addLayout(button_box) |
|  | self.setLayout(main_layout) |
|  | self.setMinimumWidth(360) |
|  | self.setWindowTitle('Find words and create deck') |

|  | def \_select_deck(self): |
|  | self.css_tb.setPlainText(self.\_setup_css()) |
|  | self.html_tb.setPlainText(self.\_setup_html()) |

|  | def \_setup_css(self): |
|  | deck \\= self.deck_selection.currentText() |
|  | try: |
|  | return self.config\[deck]\['css_text'] \|
|  | except: |
|  | return "" |

|  | def \_setup_html(self): |
|  | deck \\= self.deck_selection.currentText() |
|  | try: |
|  | return self.config\[deck]\['html_text'] \|
|  | except: |
|  | template \\= "" |
|  | template += '<div class="id">{{id}}</div>\\n' |
|  | fields \\= self.\_select_fields(self.deck_selection.currentText()) |
|  | for idx, field in enumerate(fields): |
|  | template += '<div class="field%d">{{%s}}</div>\\n' % (idx, field) |
|  | template += '-----------------------------------<br>\\n' |
|  | return template |

|  | def \_on_save(self): |
|  | self.config\[self.deck_selection.currentText()] \\= {} |
|  | self.config\[self.deck_selection.currentText()]\['html_text'] \\= self.html_tb.toPlainText() |
|  | self.config\[self.deck_selection.currentText()]\['css_text'] \\= self.css_tb.toPlainText() |
|  | dump(self.config, open(self.config_file, 'wb')) |
|  | utils.showInfo("Config saved") |

|  | def \_convert_to_multiple_choices(self, value): |
|  | choices \\= value.split("|") |
|  | letters \\= "ABCDEFGHIKLMNOP" |
|  | value \\= "<div>" |
|  | for letter, choice in zip(letters, choices): |
|  | value += '<div>'+"<span><strong>("+ letter +") </strong></span>"+ choice.strip() +'</div>' |
|  | return value + "</div>" |

|  | def \_select_fields(self, deck): |
|  | query \\= 'deck:"{}"'.format(deck) |
|  | try: |
|  | card_id \\= mw.col.findCards(query\\=query)\[0] \|
|  | except: |
|  | utils.showInfo("This deck has no cards.") |
|  | return \[] \|

|  | card \\= mw.col.getCard(card_id) |

|  | note \\= card.note() |
|  | model \\= note.model() |
|  | fields \\= card.note().keys() |
|  | return fields |

|  | def \_on_accept(self): |
|  | dialog \\= SaveFileDialog(self.deck_selection.currentText()) |
|  | path \\= dialog.filename |
|  | if path \\== None: |
|  | return |
|  | deck \\= self.deck_selection.currentText() |
|  | query \\= 'deck:"{}"'.format(deck) |
|  | cids \\= mw.col.findCards(query\\=query) |
|  | collection_path \\= mw.col.media.dir() |
|  | if sys.version_info\[0] >= 3: |
|  | path \\= path\[0] \|
|  | try: |
|  | with open(path, "w", encoding\\="utf8") as f: |
|  | html \\= "" |
|  | template \\= self.html_tb.toPlainText() |
|  | fields \\= re.findall("\\{\\{.\*\\}\\}", template) |
|  | for i, cid in enumerate(cids): |
|  | card_html \\= template |
|  | card_html \\= card_html.replace("{{id}}", str(i + 1)) |
|  | card \\= mw.col.getCard(cid) |
|  | for fi, field in enumerate(fields): |
|  | anyFieldFound \\= False #to check if any field matched, otherwise show error message in exported file. |
|  | if field \\== "{{id}}": |
|  | continue |
|  | fieldNames \\= field\[2:-2].split("//") #for decks that has multiple card types, e.g use {{Front//Text}} or {{Back//Extra}} |
|  | for fieldName in fieldNames: |
|  | try: |
|  | value \\= card.note()\[fieldName] \|
|  | value \\= re.sub(r'{{\[c|C]\[0-9]+::(.\*?)}}',r'\\g&lt;1>',value) # get rid of the cloze deletion formatting e.g. {{c1::someText}} |
|  | anyFieldFound \\= True |
|  | break |
|  | except: |
|  | continue |
|  | pictures \\= re.findall(r'src=\["|' + "']"+"(.\*?)\['|" + '"]', value) #to find src='()'or src="()" |
|  | img_tmp01 \\= 'src="%s"' |
|  | img_tmp02 \\= "src='%s'" |
|  | if len(pictures): |
|  | for pic in pictures: |
|  | full_img_path \\= os.path.join(collection_path, pic) |
|  | value \\= value.replace(img_tmp01 % pic, img_tmp01 % full_img_path) |
|  | value \\= value.replace(img_tmp02 % pic, img_tmp02 % full_img_path) |
|  | card_html \\= card_html.replace("%s" % field, value) |
|  | value \\= '' |
|  | if anyFieldFound: |
|  | html += card_html |
|  | else: |
|  | html += '\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*<br>\\n' |
|  | html += 'Card Index:' + str(i + 1) + '<br>\\n' |
|  | html += 'Card type not supported;<br>\\n' |
|  | html += 'Edit the HTML Template to support these fields: ("' + '-'.join(card.note().keys()) + '").<br>\\n' |
|  | html += '\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*<br>\\n' |

|  | output_html \\= html_template.replace("{{style}}", self.css_tb.toPlainText()) |
|  | output_html \\= output_html.replace("{{body}}", html) |
|  | f.write(output_html) |
|  | utils.showInfo("Export to HTML successfully") |
|  | except IOError: |
|  | utils.showInfo("Filename cannot special characters.") |

|  | def \_on_reject(self): |
|  | self.close() |

|  | class SaveFileDialog(QDialog): |

|  | def \_\_init\_\_(self, filename): |
|  | QDialog.\_\_init\_\_(self, mw) |
|  | self.title\\='Save File' |
|  | self.left \\= 10 |
|  | self.top \\= 10 |
|  | self.width \\= 640 |
|  | self.height \\= 480 |
|  | self.filename \\= None |
|  | self.default_filename \\= filename |
|  | self.\_init_ui() |

|  | def \_init_ui(self): |
|  | self.setWindowTitle(self.title) |
|  | self.setGeometry(self.left, self.top, self.width, self.height) |
|  | self.filename \\= self.\_get_file() |

|  | def \_get_file(self): |
|  | options \\= QFileDialog.Options() |
|  | options |= QFileDialog.DontUseNativeDialog |
|  | default_filename \\= self.default_filename.replace('::', '\_') |
|  | directory \\= os.path.join(expanduser("~/Desktop"), default_filename + ".html") |
|  | try: |
|  | path \\= QFileDialog.getSaveFileName(self, "Save File", directory, "All Files (\*)", options\\=options) |
|  | if path: |
|  | return path |
|  | else: |
|  | utils.showInfo("Cannot open this file.") |
|  | except: |
|  | utils.showInfo("Cannot open this file.") |
|  | return None |

|  | def display_dialog(): |
|  | dialog \\= AddonDialog() |
|  | dialog.exec\_() |

|  | action \\= QAction("Export deck to html", mw) |
|  | action.setShortcut("Ctrl+M") |
|  | action.triggered.connect(display_dialog) |
|  | mw.form.menuTools.addAction(action) |

-   Copy lines
-   Copy permalink
-   [View git blame](/TruongQToan/Export-deck-to-HTML-Anki-Addon/blame/7800d0c5a2cf425d948aa981288cf97e0190a906/Export_deck_to_HTML.py)
-   [Reference in new issue](/TruongQToan/Export-deck-to-HTML-Anki-Addon/issues/new)

    Go 

## Footer

[](https://github.com "GitHub")© 2022 GitHub, Inc.

### Footer navigation

-   [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
-   [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
-   [Security](https://github.com/security)
-   [Status](https://www.githubstatus.com/)
-   [Docs](https://docs.github.com)
-   [Contact GitHub](https://support.github.com?tags=dotcom-footer)
-   [Pricing](https://github.com/pricing)
-   [API](https://docs.github.com)
-   [Training](https://services.github.com)
-   [Blog](https://github.blog)
-   [About](https://github.com/about)

You can’t perform that action at this time.

You signed in with another tab or window. Reload to refresh your session. You signed out in another tab or window. Reload to refresh your session.
